<div class="post-header">
    <h2>Escape Room</h2>
    <h4>ðŸš§En construcciÃ³nðŸš§</h4>
</div>

<style>
.slot-machine {
  text-align: center;
  padding: 20px;
}

.slot-container {
  display: flex;
  justify-content: center;
  gap: 15px;
  margin: 20px 0;
}

.slot {
  width: 60px;
  height: 80px;
  border: 2px solid #333;
  border-radius: 8px;
  background: white;
  overflow: hidden;
  position: relative;
}

.slot-letters {
  position: absolute;
  width: 100%;
  height: calc(80px * 26);
  transition: transform 0.3s ease;
}

.slot-letter {
  height: 80px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
  font-weight: bold;
  color: #333;
  user-select: none;
}

.slot::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(to bottom, 
    rgba(255,255,255,1) 0%,
    rgba(255,255,255,0) 30%,
    rgba(255,255,255,0) 70%,
    rgba(255,255,255,1) 100%
  );
  pointer-events: none;
}
</style>

<div class="post-content">
    <p>amanece y la anciana quiere ir al huerTo a por un Higo. intenta abrir la puerta, pero en vez de llave Tiene un cÃ³digo, y no lo recuerda.</p>
</div>

<div class="slot-machine">
  <div class="slot-container">
    <div class="slot" id="slot1">
      <div class="slot-letters"></div>
    </div>
    <div class="slot" id="slot2">
      <div class="slot-letters"></div>
    </div>
    <div class="slot" id="slot3">
      <div class="slot-letters"></div>
    </div>
  </div>
  <button id="checkButton">Abrir puerta</button>
</div>

<script>
const gameState = {
  currentPuzzle: 1,
  puzzles: {
    1: {
      text: "amanece y la anciana quiere ir al huerTo a por un Higo. intenta abrir la puerta, pero en vez de llave Tiene un cÃ³digo, y no lo recuerda.",
      solution: "THT",
      nextPuzzle: 2
    },
    2: {
      text: "Ahora la anciana encuentra un cofre con un candado numÃ©rico... (texto puzzle 2)",
      solution: "1234",
      nextPuzzle: 3
    }
  }
};

class SlotMachine {
  constructor(container) {
    this.container = container;
    this.letters = ['A','B','C','D','E','F','G','H','I','J','K','L','M',
                   'N','O','P','Q','R','S','T','U','V','W','X','Y','Z'];
    this.selectedIndex = 0;
    this.init();
  }

  init() {
    const lettersContainer = this.container.querySelector('.slot-letters');
    lettersContainer.innerHTML = '';
    
    this.letters.forEach(letter => {
      const div = document.createElement('div');
      div.className = 'slot-letter';
      div.textContent = letter;
      lettersContainer.appendChild(div);
    });

    lettersContainer.style.transform = `translateY(-${this.selectedIndex * 80}px)`;

    let startY = 0;
    let isDragging = false;
    let currentYPosition = 0;

    // Eventos tÃ¡ctiles
    this.container.addEventListener('touchstart', e => {
      startY = e.touches[0].clientY;
      currentYPosition = parseInt(lettersContainer.style.transform.replace('translateY(', '').replace('px)', '')) || 0;
      isDragging = true;
    });

    this.container.addEventListener('touchmove', e => {
      if (!isDragging) return;
      const deltaY = e.touches[0].clientY - startY;
      lettersContainer.style.transform = `translateY(${currentYPosition + deltaY}px)`;
    });

    this.container.addEventListener('touchend', () => {
      isDragging = false;
      this.snapToLetter(lettersContainer);
    });

    // Eventos de ratÃ³n
    this.container.addEventListener('mousedown', e => {
      startY = e.clientY;
      currentYPosition = parseInt(lettersContainer.style.transform.replace('translateY(', '').replace('px)', '')) || 0;
      isDragging = true;
    });

    document.addEventListener('mousemove', e => {
      if (!isDragging) return;
      const deltaY = e.clientY - startY;
      lettersContainer.style.transform = `translateY(${currentYPosition + deltaY}px)`;
    });

    document.addEventListener('mouseup', () => {  
      if (!isDragging) return;
      isDragging = false;
      this.snapToLetter(lettersContainer);
    });
  }

  snapToLetter(lettersContainer) {
    const currentPosition = parseInt(lettersContainer.style.transform.replace('translateY(', '').replace('px)', '')) || 0;
    this.selectedIndex = Math.round(-currentPosition / 80);
    this.selectedIndex = Math.max(0, Math.min(this.selectedIndex, this.letters.length - 1));
    lettersContainer.style.transform = `translateY(-${this.selectedIndex * 80}px)`;
  }

  getSelectedLetter() {
    return this.letters[this.selectedIndex];
  }
}

class EscapeRoom {
  constructor() {
    this.slots = [];
    this.initPuzzle(gameState.currentPuzzle);
  }

  initPuzzle(puzzleId) {
    this.slots = [];
    const puzzle = gameState.puzzles[puzzleId];
    document.querySelector('.post-content p').textContent = puzzle.text;

    if(puzzleId === 1) {
      this.setupSlotMachine(puzzle.solution);
    }
  }

  setupSlotMachine(solution) {
    this.slots.push(
      new SlotMachine(document.getElementById('slot1')),
      new SlotMachine(document.getElementById('slot2')),
      new SlotMachine(document.getElementById('slot3'))
    );

    document.getElementById('checkButton').onclick = () => {
      const combination = this.slots.map(slot => slot.getSelectedLetter()).join('');
      if(combination === solution) {
        this.nextPuzzle();
      } else {
        alert('CÃ³digo incorrecto. Sigue intentÃ¡ndolo.');
      }
    };
  }

  nextPuzzle() {
    const nextId = gameState.puzzles[gameState.currentPuzzle].nextPuzzle;
    if(nextId) {
      gameState.currentPuzzle = nextId;
      this.initPuzzle(nextId);
      alert('Â¡Puzzle completado! Avanzando al siguiente desafÃ­o...');
    } else {
      alert('Â¡Has completado todos los puzzles!');
    }
  }
}

document.addEventListener('DOMContentLoaded', () => {
  new EscapeRoom();
});
</script>

<div class="post-footer">
    <a href="../tantoshigostanto/glosario.html#trendy" class="read-more">ExplicaciÃ³n del recurso â†’</a>
</div>
